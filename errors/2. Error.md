# ðŸ”§ If I Were to Start Again: EKS + GitHub Actions Setup Checklist

---

## 1. Create a Special IAM Role for GitHub Actions (Before Terraform Apply)

* Create an IAM role named `GitHubActionsEKSRole` with `AmazonEKSClusterAccess` or `AdministratorAccess` permissions.
* Allow GitHub Actions to assume this role later if needed.
* Alternatively, create a user (like `github-actions-user`) early with clear, scoped permissions.

---

## 2. Add the IAM Role/User to `aws-auth` ConfigMap in Terraform (During Cluster Creation)

* When defining `access_entries` in the Terraform EKS module, immediately add the GitHub Actions IAM user or role.
* Example: associate the principal\_arn with `system:masters` group.
* This ensures GitHub Actions has permission **from the first Terraform apply**.

---

## 3. Configure Kubernetes Authentication (`aws eks get-token`) for GitHub Actions

* Assume GitHub Actions needs a token to authenticate to EKS.
* After creating the cluster, immediately test kubeconfig setup:

```bash
aws eks update-kubeconfig --region us-east-1 --name my-eks-cluster
kubectl get nodes
```

* Test it **using the GitHub Actions IAM credentials** to verify it works early.

---

## 4. Add GitHub Secrets Early

* Set up GitHub Secrets before writing the full Actions workflow:

  * `AWS_ACCESS_KEY_ID`
  * `AWS_SECRET_ACCESS_KEY`
  * `AWS_REGION`
  * `AWS_ACCOUNT_ID`
* This ensures that the GitHub Action has access to AWS services when triggered.

---

## 5. Write a Simpler Initial GitHub Actions Workflow

* Start by only testing the cluster connection:

  * Checkout code âœ…
  * Configure AWS credentials âœ…
  * Update kubeconfig âœ…
  * Run `kubectl get nodes` âœ…
* Only after confirming cluster access, add:

  * Docker build
  * Push to ECR
  * Helm deployments
* **Start simple, then grow your pipeline.**

---

## âš¡ Current Error Explanation

The error currently faced is because the `kubectl config set-credentials` command is missing the required `--exec-interactive-mode Never` flag when setting up the Kubernetes credentials for GitHub Actions. Kubernetes versions 1.26 and above enforce that `interactiveMode` must be specified when configuring an exec plugin, especially in non-interactive environments like CI/CD pipelines. Without this flag, `kubectl` cannot correctly authenticate to EKS, and the GitHub Action fails when trying to run `helm upgrade`. Adding `--exec-interactive-mode Never` after setting the authentication arguments resolves this issue by properly telling Kubernetes that no user interaction is needed.

---

## ðŸ”„ Summary

> If you set correct IAM permissions early, include GitHub Actions user in `aws-auth` during Terraform, test kubeconfig connection using `aws eks get-token`, and push a minimal GitHub Actions pipeline first, **you can avoid 90% of the common errors.**

---



kubectl get nodes --token=$(aws eks get-token --region ${{ secrets.AWS_REGION }} --cluster-name my-eks-cluster --query "status.token" --output text)
